name: arca-router
version: ${VERSION}
release: 1
epoch: 0
arch: x86_64
license: Apache-2.0
vendor: akam1o
maintainer: akam1o <akam1o@ark-networks.net>
homepage: https://github.com/akam1o/arca-router
description: |
  ARCA Router - VPP-based Network Router Daemon

  - Real VPP integration via govpp
  - FRR integration for dynamic routing (BGP, OSPF)
  - LCP (Linux Control Plane) support
  - Junos-style configuration interface
  - NETCONF support for remote management

# VPP and FRR dependencies
depends:
  - vpp >= 24.10
  - vpp-plugin-core >= 24.10
  - frr >= 8.0

contents:
  # Daemon binary
  - src: build/bin/arca-routerd
    dst: /usr/sbin/arca-routerd
    file_info:
      mode: 0755
      owner: root
      group: root

  # CLI binary
  - src: build/bin/arca-cli
    dst: /usr/bin/arca-cli
    file_info:
      mode: 0755
      owner: root
      group: root

  # NETCONF daemon binary
  - src: build/bin/arca-netconfd
    dst: /usr/sbin/arca-netconfd
    file_info:
      mode: 0755
      owner: root
      group: root

  # Configuration directory
  - dst: /etc/arca-router
    type: dir
    file_info:
      mode: 0755
      owner: root
      group: root

  # Example configurations (installed as .example, not active configs)
  - src: examples/arca-router.conf
    dst: /etc/arca-router/arca-router.conf.example
    type: config
    file_info:
      mode: 0644
      owner: root
      group: root

  - src: examples/hardware.yaml
    dst: /etc/arca-router/hardware.yaml.example
    type: config
    file_info:
      mode: 0644
      owner: root
      group: root

  # systemd unit files
  - src: build/systemd/arca-routerd.service
    dst: /usr/lib/systemd/system/arca-routerd.service
    file_info:
      mode: 0644
      owner: root
      group: root

  - src: build/systemd/arca-netconfd.service
    dst: /usr/lib/systemd/system/arca-netconfd.service
    file_info:
      mode: 0644
      owner: root
      group: root

  # Runtime data directory
  - dst: /var/lib/arca-router
    type: dir
    file_info:
      mode: 0755
      owner: root
      group: root

  # Log directory
  - dst: /var/log/arca-router
    type: dir
    file_info:
      mode: 0750
      owner: root
      group: root

  # logrotate configuration
  - src: build/package/logrotate.conf
    dst: /etc/logrotate.d/arca-router
    type: config
    file_info:
      mode: 0644
      owner: root
      group: root

# Installation scripts
scripts:
  preinstall: build/package/scripts/preinstall.sh
  postinstall: build/package/scripts/postinstall.sh
  preuninstall: build/package/scripts/preuninstall.sh
  postuninstall: build/package/scripts/postuninstall.sh
  posttrans: build/package/scripts/posttrans.sh

# RPM-specific settings
rpm:
  group: System Environment/Daemons
  compression: xz
  signature:
    key_file: ""
    key_id: ""

overrides:
  rpm:
    # Use x86_64 for RPM architecture
    arch: x86_64
  deb:
    # Use amd64 for DEB architecture
    arch: amd64
    # Allow building Ubuntu-flavored DEBs via `DEB_RELEASE` (e.g. `1~ubuntu22.04`).
    # Defaults to `1` when unset.
    release: '{{ if .Env.DEB_RELEASE }}{{ .Env.DEB_RELEASE }}{{ else }}1{{ end }}'
    # DEB-specific fields
    priority: optional
    section: net
